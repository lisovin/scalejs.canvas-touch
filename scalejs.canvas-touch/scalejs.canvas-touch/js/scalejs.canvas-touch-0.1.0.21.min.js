define("scalejs.canvas-touch/canvas-touch",["hammer"],function(e){return function(t){function a(e){"[object Object]"===Object.prototype.toString.call(e)&&(M=e.left,j=e.top,I=e.rotate,R=e.scale)}function g(e){"[object Boolean]"===Object.prototype.toString.call(e)&&(m=e)}function n(){x=window.getComputedStyle(y),w=Math.max(parseInt(x.width,10),1),b=Math.max(parseInt(x.height,10),1),r.width=w,r.height=b,l.style.width=w,l.style.height=b,l.setAttribute("width",w),l.setAttribute("height",b)}function p(e){function t(e,t){var a=e.pageX-t.pageX,g=e.pageY-t.pageY;return Math.sqrt(a*a+g*g)}if(e.gesture){e.gesture.preventDefault();var g,p,o,s,h,x,C,T,k,A=e.gesture,D=[],O=0,E=0,B=1;for(k=0;k<A.touches.length;k+=1)D[k]={pageX:A.touches[k].pageX,pageY:A.touches[k].pageY};"touch"===e.type?(S=!0,u=D,d=2===D.length?{x:(D[0].pageX-D[1].pageX)/2+D[1].pageX,y:(D[0].pageY-D[1].pageY)/2+D[1].pageY}:{x:D[0].pageX,y:D[0].pageY},n(),a(f(M,j,I,R)),i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,w,b),i.drawImage(y,0,0),l.style.display="",y.style.display="none",X(0,0,0,1),c.clearRect(0,0,w,b),c.drawImage(y,0,0)):"release"===e.type?(S=!1,u=void 0,d=void 0,a(v(M,j,I,R)),X(M,j,I,R),y.style.display="",l.style.display="none"):(void 0===u&&(u=D),1===D.length?(1!==u.length&&(u=D,d=void 0),g={x:D[0].pageX,y:D[0].pageY},M+=D[0].pageX-u[0].pageX,j+=D[0].pageY-u[0].pageY):2===D.length&&(2!==u.length&&(u=D,d=void 0),g={x:(D[0].pageX-D[1].pageX)/2+D[1].pageX,y:(D[0].pageY-D[1].pageY)/2+D[1].pageY},void 0===d&&(d=g),p=t(D[0],D[1])/t(u[0],u[1]),R*=p,m&&(O=Math.atan2(u[0].pageX-d.x,u[0].pageY-d.y)-Math.atan2(D[0].pageX-g.x,D[0].pageY-g.y),E=Math.sin(O),B=Math.cos(O),O*=180/Math.PI,I+=O),o=e.currentTarget.getBoundingClientRect(),s={pageX:g.x,pageY:g.y},s.pageX-=o.left,s.pageY-=o.top,h={x:M-s.pageX,y:j-s.pageY},x={x:h.x*B-h.y*E+s.pageX,y:h.x*E+h.y*B+s.pageY},C={x:p*(x.x-s.pageX)+s.pageX-M,y:p*(x.y-s.pageY)+s.pageY-j},T={x:C.x+(g.x-d.x),y:C.y+(g.y-d.y)},M+=T.x,j+=T.y),i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,w,b),i.translate(M,j),i.scale(R,R),i.rotate(I/180*Math.PI),i.translate(-M,-j),i.drawImage(r,M,j),i.setTransform(1,0,0,1,0,0),a(Y(M,j,I,R)),u=D,d=g)}}function o(t){var a,g,n=e.event.getTouchList(t,"scroll"),p=t.wheelDelta,o={preventDefault:function(){},touches:[{pageX:n[0].pageX+100,pageY:n[0].pageY},{pageX:n[0].pageX-100,pageY:n[0].pageY}]};p=p>0?100/3:0>p?-25:0,S?(a=u,g=d,u=[{pageX:n[0].pageX+100,pageY:n[0].pageY},{pageX:n[0].pageX-100,pageY:n[0].pageY}],d={x:n[0].pageX,y:n[0].pageY},o.touches[0].pageX+=p,o.touches[1].pageX-=p,h.trigger("pinch",o),u=a,d=g):(h.trigger("touch",o),o.touches[0].pageX+=p,o.touches[1].pageX-=p,h.trigger("pinch",o),h.trigger("release",o)),t.preventDefault()}function s(){h.off("touch drag swipe pinch rotate transform release",p),h.off("mousewheel",o),h.enable(!1),C.removeChild(l)}var r,c,l,i,h,u,d,y=t.canvas,X=t.renderCallback,f=t.startCallback||function(){},Y=t.stepCallback||function(){},v=t.endCallback||function(){},m=void 0!==t.enableRotate?t.enableRotate:!0,x=window.getComputedStyle(y),w=Math.max(parseInt(x.width,10),1),b=Math.max(parseInt(x.height,10),1),C=y.parentNode,M=0,j=0,I=0,R=1,S=!1;return r=document.createElement("canvas"),r.width=w,r.height=b,c=r.getContext("2d"),l=document.createElement("canvas"),l.style.position="absolute",l.style.left=0,l.style.top=0,l.style.display="none",l.style.width=w,l.style.height=b,l.setAttribute("width",w),l.setAttribute("height",b),i=l.getContext("2d"),C.appendChild(l),h=e(C,{prevent_default:!0}),h.on("touch drag swipe pinch rotate transform release",p),h.on("mousewheel",o),{hammerObj:h,setRotateState:g,remove:s}}}),define("scalejs.canvas-touch",["scalejs!core","./scalejs.canvas-touch/canvas-touch"],function(e,t){e.registerExtension({canvas:{touch:t}})});